!function(){"use strict";function e(){return{create:t}}function t(e,t,n,r,a,i,o,s){function u(){y.dirty=!0}function l(a,i){"boolean"==typeof a&&(i=a,a=null);var o=e.defer();return o.promise.then(function(e){return a?a(e):void 0},function(e){},function(e){return a?a(e):void 0}),y.staticData&&y.initialFetch&&!i&&!y.dirty?o.resolve(t.data[r]):n.getAll(function(e){(e.length!=t.data[r].length||y.dirty||i||!y.initialFetch)&&(y.initialFetch=!0,t.data[r]=e,y.dirty=!1),o.resolve(e)}),o.promise}function c(e,t,n){var r=p(e);null==r||y.dirty||n?l(null,!0).then(function(n){return t?void m(t,p(e)):void 0},function(e){t(null)},function(e){}):m(t,r)}function m(e,t){if(t)if(i&&y.singleElements[t.UID])e(y.singleElements[t.UID]);else if(i){var n={};n[o]=t[s],i(n,function(n){y.singleElements[t.UID]=n,e(n)})}else e(t);else e(void 0)}function p(e){for(var n=0;n<t.data[r].length;n++){var a=t.data[r][n];if(e(a))return a}return null}function h(e){for(var n=0;n<t.data[r].length;n++){var a=t.data[r][n];if(e(a))return n}return-1}function f(e){t.data[r].push(e)}function d(e,n){"undefined"==typeof n&&t.data[r].indexOf(e)!==-1?t.data[r].splice(t.data[r].indexOf(e),1):"undefined"!=typeof n&&n!==-1&&t.data[r].splice(n,1)}function g(e){var n=t.data[r].indexOf(e);t.data[r][n]=e}function v(e,n){var a=[];t.data[r].forEach(function(t){e(t)&&a.push(t)}),n(a)}var y=this;return this.dirty=!1,this.initialFetch=!1,this.staticData=a,this.singleElements=i?{}:null,{add:f,remove:d,update:g,getAll:l,getOne:c,find:p,filter:v,findByIndex:h,setDirty:u}}angular.module("PaperUI.services.repositories",["PaperUI.services.rest"]).factory("Repository",e)}(),angular.module("PaperUI.services.repositories").factory("bindingRepository",["Repository","$q","$rootScope","bindingService",function(e,t,n,r){return n.data.bindings=[],new e.create(t,n,r,"bindings",(!0))}]).factory("thingTypeRepository",["Repository","$q","$rootScope","thingTypeService",function(e,t,n,r){return n.data.thingTypes=[],new e.create(t,n,r,"thingTypes",(!0),r.getByUid,"thingTypeUID","UID")}]).factory("channelTypeRepository",["Repository","$q","$rootScope","channelTypeService",function(e,t,n,r){return n.data.channelTypes=[],new e.create(t,n,r,"channelTypes",(!0))}]).factory("discoveryResultRepository",["Repository","$q","$rootScope","inboxService","eventService",function(e,t,n,r,a){var i=new e.create(t,n,r,"discoveryResults");return n.data.discoveryResults=[],a.onEvent("smarthome/inbox/*",function(e,t){var n=i.findByIndex(function(e){return t.thingUID==e.thingUID}),r=e.substring(e.lastIndexOf("/")+1);"added"===r&&n==-1&&i.add(t),"removed"===r&&n!=-1&&i.remove(void 0,n),"updated"===r&&n!=-1&&(i.remove(void 0,n),i.add(t))}),i}]).factory("thingRepository",["Repository","$q","$rootScope","thingService","eventService",function(e,t,n,r,a){var i=new e.create(t,n,r,"things");n.data.things=[];var o=function(e){return e.replace(/_/g,":")},s=function(e,t,r){var a=i.find(function(t){return t.UID===e});(a&&t||!a&&!t)&&n.$apply(function(e){r(a)})};return a.onEvent("smarthome/things/*/status",function(e,t){s(e.split("/")[2],!0,function(e){e.statusInfo=t})}),a.onEvent("smarthome/things/*/added",function(e,t){s(e.split("/")[2],!1,function(e){i.add(t)})}),a.onEvent("smarthome/things/*/updated",function(e,t){var n=t[0];s(e.split("/")[2],!0,function(e){if(n){e.label=n.label,e.configuration=n.configuration;var t=[];n.channels&&(angular.forEach(n.channels,function(n){var r=$.grep(e.channels,function(e){return e.uid==n.uid});0==r.length?(r[0]=n,r[0].linkedItems=[]):(r[0].configuration=n.configuration,r[0].itemType=n.itemType),t.push(r[0])}),e.channels=t)}})}),a.onEvent("smarthome/things/*/removed",function(e,t){s(e.split("/")[2],!0,function(e){i.remove(e)})}),a.onEvent("smarthome/items/*/added",function(e,t){s(o(e.split("/")[2]),!0,function(e){e.item=t})}),a.onEvent("smarthome/links/*/added",function(e,t){var n,r=t.channelUID.split(":");r.length>2&&(n=r[0]+":"+r[1]+":"+r[2]),n&&s(n,!0,function(e){var n=$.grep(e.channels,function(e){return e.uid==t.channelUID});n.length>0&&(n[0].linkedItems=n[0].linkedItems?n[0].linkedItems:[],n[0].linkedItems.push(t.itemName))})}),a.onEvent("smarthome/links/*/removed",function(e,t){var n,r=t.channelUID.split(":");r.length>2&&(n=r[0]+":"+r[1]+":"+r[2]),n&&s(n,!0,function(e){var n=$.grep(e.channels,function(e){return e.uid==t.channelUID});n.length>0&&(n[0].linkedItems=[])})}),i}]).factory("itemRepository",["Repository","$q","$rootScope","itemService","eventService",function(e,t,n,r,a){var i=new e.create(t,n,r,"items");return n.data.items=[],a.onEvent("smarthome/items/*/updated",function(e,t){if(e.split("/").length>2){var r=i.findByIndex(function(t){return t.name==e.split("/")[2]});r!==-1&&n.$apply(function(){n.data.items[r]=t[0]})}}),a.onEvent("smarthome/items/*/added",function(e,t){if(e.split("/").length>2){var r=i.findByIndex(function(e){return e.name===t.name});r===-1&&n.data.items&&i.getOne(function(e){return e.name===t.name},function(e){n.data.items.push(e)},!0)}}),a.onEvent("smarthome/items/*/removed",function(e,t){if(e.split("/").length>2){var r=i.findByIndex(function(e){return e.name==t.name});r!==-1&&n.$apply(function(){n.data.items.splice(r,1)})}}),i}]).factory("ruleRepository",["Repository","$q","$rootScope","ruleService","eventService",function(e,t,n,r,a){var i=new e.create(t,n,r,"rules",(!0));return n.data.rules=[],a.onEvent("smarthome/rules/*/updated",function(e,t){var r=i.find(function(e){return e.uid===t[0].uid});n.$apply(function(){r&&(r.name=t[0].name,r.description=t[0].description,r.triggers=t[0].triggers,r.actions=t[0].actions,r.conditions=t[0].conditions)})}),a.onEvent("smarthome/rules/*/added",function(e,t){n.$apply(function(){i.add(t)})}),a.onEvent("smarthome/rules/*/removed",function(e,t){var r=i.find(function(e){return e.uid===t.uid});n.$apply(function(){i.remove(r)})}),a.onEvent("smarthome/rules/*/state",function(e,t){var r=i.find(function(t){return t.uid===e.split("/")[2]});n.$apply(function(){r.status={},r.status.status=t.status,r.status.statusDetail=t.statusDetail,"DISABLED"===t.status.toUpperCase()?r.enabled=!1:r.enabled=!0})}),i}]).factory("templateRepository",["Repository","$q","$rootScope","templateService",function(e,t,n,r){var a=new e.create(t,n,r,"templates");return n.data.templates=[],a}]),angular.module("PaperUI.services.rest",["PaperUI.constants","ngResource"]).config(["$httpProvider",function(e){var t=function(){return $("#authentication").data("access-token")}();if("{{ACCESS_TOKEN}}"!=t){var n=function(){return"Bearer "+t}();e.defaults.headers.common.Authorization=n}}]).factory("itemService",["$resource","restConfig",function(e,t){return e(t.restPath+"/items",{},{getAll:{method:"GET",isArray:!0,url:t.restPath+"/items?recursive=false"},getByName:{method:"GET",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName"},remove:{method:"DELETE",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName"},create:{method:"PUT",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName",transformResponse:function(e,t,n){var e=angular.fromJson(e);return 405==n&&(e.customMessage="Item is not editable."),e}},updateState:{method:"PUT",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName/state",headers:{"Content-Type":"text/plain"}},getItemState:{method:"GET",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName/state",transformResponse:function(e){return e},headers:{"Content-Type":"text/plain"}},sendCommand:{method:"POST",params:{itemName:"@itemName"},url:t.restPath+"/items/:itemName",headers:{"Content-Type":"text/plain"}},addMember:{method:"PUT",params:{itemName:"@itemName",memberItemName:"@memberItemName"},url:t.restPath+"/items/:itemName/members/:memberItemName"},removeMember:{method:"DELETE",params:{itemName:"@itemName",memberItemName:"@memberItemName"},url:t.restPath+"/items/:itemName/members/:memberItemName"},addTag:{method:"PUT",params:{itemName:"@itemName",tag:"@tag"},url:t.restPath+"/items/:itemName/tags/:tag"},removeTag:{method:"DELETE",params:{itemName:"@itemName",tag:"@tag"},url:t.restPath+"/items/:itemName/tags/:tag"},updateMetadata:{method:"PUT",params:{itemName:"@itemName",namespace:"@namespace"},url:t.restPath+"/items/:itemName/metadata/:namespace"}})}]).factory("bindingService",["$resource","restConfig",function(e,t){return e(t.restPath+"/bindings",{},{getAll:{method:"GET",isArray:!0},getConfigById:{method:"GET",params:{id:"@id"},interceptor:{response:function(e){return e.data}},url:t.restPath+"/bindings/:id/config"},updateConfig:{method:"PUT",headers:{"Content-Type":"application/json"},params:{id:"@id"},url:t.restPath+"/bindings/:id/config"}})}]).factory("inboxService",["$resource","restConfig",function(e,t){return e(t.restPath+"/inbox",{},{getAll:{method:"GET",isArray:!0,transformResponse:function(e){for(var t=angular.fromJson(e),n=0;n<t.length;n++)t[n].bindingType=t[n].thingTypeUID.split(":")[0];return t}},approve:{method:"POST",params:{thingUID:"@thingUID"},url:t.restPath+"/inbox/:thingUID/approve",headers:{"Content-Type":"text/plain"}},ignore:{method:"POST",params:{thingUID:"@thingUID"},url:t.restPath+"/inbox/:thingUID/ignore"},unignore:{method:"POST",params:{thingUID:"@thingUID"},url:t.restPath+"/inbox/:thingUID/unignore"},remove:{method:"DELETE",params:{thingUID:"@thingUID"},url:t.restPath+"/inbox/:thingUID"}})}]).factory("discoveryService",["$resource","restConfig",function(e,t){return e(t.restPath+"/discovery",{},{getAll:{method:"GET",isArray:!0},scan:{method:"POST",params:{bindingId:"@bindingId"},transformResponse:function(e){return{timeout:angular.fromJson(e)}},url:t.restPath+"/discovery/bindings/:bindingId/scan"}})}]).factory("thingTypeService",["$resource","restConfig",function(e,t){return e(t.restPath+"/thing-types",{},{getAll:{method:"GET",isArray:!0},getByUid:{method:"GET",params:{thingTypeUID:"@thingTypeUID"},url:t.restPath+"/thing-types/:thingTypeUID"}})}]).factory("linkService",["$resource","restConfig",function(e,t){return e(t.restPath+"/links",{},{getAll:{method:"GET",isArray:!0},link:{method:"PUT",params:{itemName:"@itemName",channelUID:"@channelUID"},url:t.restPath+"/links/:itemName/:channelUID"},unlink:{method:"DELETE",params:{itemName:"@itemName",channelUID:"@channelUID"},url:t.restPath+"/links/:itemName/:channelUID"}})}]).factory("thingService",["$resource","restConfig",function(e,t){return e(t.restPath+"/things",{},{getAll:{method:"GET",isArray:!0},getByUid:{method:"GET",params:{bindingId:"@thingUID"},url:t.restPath+"/things/:thingUID"},remove:{method:"DELETE",params:{thingUID:"@thingUID"},url:t.restPath+"/things/:thingUID"},add:{method:"POST",url:t.restPath+"/things",headers:{"Content-Type":"application/json"}},update:{method:"PUT",params:{thingUID:"@thingUID"},url:t.restPath+"/things/:thingUID",headers:{"Content-Type":"application/json"}},updateConfig:{method:"PUT",params:{thingUID:"@thingUID"},url:t.restPath+"/things/:thingUID/config",headers:{"Content-Type":"application/json"}},getFirmwareStatus:{method:"GET",params:{thingUID:"@thingUID"},url:t.restPath+"/things/:thingUID/firmware/status"},getFirmwares:{method:"GET",isArray:!0,params:{thingUID:"@thingUID"},url:t.restPath+"/things/:thingUID/firmwares"},installFirmware:{method:"PUT",params:{thingUID:"@thingUID",firmwareVersion:"@firmwareVersion"},url:t.restPath+"/things/:thingUID/firmware/:firmwareVersion"}})}]).factory("serviceConfigService",["$resource","restConfig",function(e,t){return e(t.restPath+"/services",{},{getAll:{method:"GET",isArray:!0},getContexts:{method:"GET",params:{id:"@id"},isArray:!0,url:t.restPath+"/services/:id/contexts"},getById:{method:"GET",params:{id:"@id"},url:t.restPath+"/services/:id"},getConfigById:{method:"GET",params:{id:"@id"},interceptor:{response:function(e){return e.data}},url:t.restPath+"/services/:id/config"},updateConfig:{method:"PUT",headers:{"Content-Type":"application/json"},params:{id:"@id"},url:t.restPath+"/services/:id/config"},deleteConfig:{method:"DELETE",params:{id:"@id"},url:t.restPath+"/services/:id/config"}})}]).factory("configDescriptionService",["$resource","restConfig",function(e,t){return e(t.restPath+"/config-descriptions",{},{getAll:{method:"GET",isArray:!0,params:{scheme:"@scheme"}},getByUri:{method:"GET",params:{uri:"@uri"},transformResponse:function(e,t,n){var e=angular.fromJson(e);return 404==n&&(e.showError=!1),e},url:t.restPath+"/config-descriptions/:uri"}})}]).factory("extensionService",["$resource","restConfig","$http",function(e,t,n){var r=e(t.restPath+"/extensions",{},{getAll:{method:"GET",isArray:!0,transformResponse:function(e,t,n){return 503==n?{showError:!1}:angular.fromJson(e)}},getByUri:{method:"GET",params:{uri:"@id"},url:t.restPath+"/extensions/:id"},getAllTypes:{method:"GET",isArray:!0,url:t.restPath+"/extensions/types"},install:{method:"POST",params:{id:"@id"},url:t.restPath+"/extensions/:id/install"},installFromURL:{method:"POST",params:{url:"@url"},url:t.restPath+"/extensions/url/:url/install"},uninstall:{method:"POST",params:{id:"@id"},url:t.restPath+"/extensions/:id/uninstall"}}),a=function(e,t,n){return 503!=n?e:{showError:!1}};return r.isAvailable=function(e){n.head(t.restPath+"/extensions",{transformResponse:a}).then(function(){e(!0)},function(){e(!1)})},r}]).factory("ruleService",["$resource","restConfig",function(e,t){return e(t.restPath+"/rules",{},{getAll:{method:"GET",isArray:!0},getByUid:{method:"GET",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID"},add:{method:"POST",headers:{"Content-Type":"application/json"}},remove:{method:"DELETE",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID"},getModuleConfigParameter:{method:"GET",params:{ruleUID:"@ruleUID"},transformResponse:function(e,t,n){return{content:e}},url:t.restPath+"/rules/:ruleUID/actions/action/config/script"},setModuleConfigParameter:{method:"PUT",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID/actions/action/config/script",headers:{"Content-Type":"text/plain"}},update:{method:"PUT",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID",headers:{"Content-Type":"application/json"}},setEnabled:{method:"POST",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID/enable",headers:{"Content-Type":"text/plain"}},runRule:{method:"POST",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID/runnow",headers:{"Content-Type":"text/plain"}}})}]).factory("moduleTypeService",["$resource","restConfig",function(e,t){return e(t.restPath+"/module-types",{},{getAll:{method:"GET",isArray:!0},getByType:{method:"GET",params:{mtype:"@mtype"},url:t.restPath+"/module-types?type=:mtype",isArray:!0},getByUid:{method:"GET",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID"},getModuleConfigByUid:{method:"GET",params:{ruleUID:"@ruleUID",moduleCategory:"@moduleCategory",id:"@id"},url:t.restPath+"/rules/:ruleUID/:moduleCategory/:id/config"},add:{method:"POST",headers:{"Content-Type":"application/json"}},remove:{method:"DELETE",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID"},getModuleConfigParameter:{method:"GET",params:{ruleUID:"@ruleUID"},transformResponse:function(e,t,n){return{content:e}},url:t.restPath+"/rules/:ruleUID/actions/action/config/script"},setModuleConfigParameter:{method:"PUT",params:{ruleUID:"@ruleUID"},url:t.restPath+"/rules/:ruleUID/actions/action/config/script",headers:{"Content-Type":"text/plain"}}})}]).factory("channelTypeService",["$resource","restConfig",function(e,t){return e(t.restPath+"/channel-types",{},{getAll:{method:"GET",isArray:!0},getByUri:{method:"GET",params:{channelTypeUID:"@channelTypeUID"},url:t.restPath+"/channel-types/:channelTypeUID"},getLinkableItemTypes:{method:"GET",isArray:!0,params:{channelTypeUID:"@channelTypeUID"},url:t.restPath+"/channel-types/:channelTypeUID/linkableItemTypes"}})}]).factory("templateService",["$resource","restConfig",function(e,t){return e(t.restPath+"/channel-types",{},{getAll:{method:"GET",url:t.restPath+"/templates",isArray:!0},getByUid:{method:"GET",params:{templateUID:"@templateUID"},url:t.restPath+"/templates/:templateUID"}})}]).factory("imageService",["restConfig","$http",function(e,t){return{getItemState:function(n){var r=t.get(e.restPath+"/items/"+n+"/state").then(function(e){return e.data});return r}}}]).factory("firmwareService",["$resource","restConfig",function(e,t){return e(t.restPath+"/firmware",{},{getStatus:{method:"GET",isArray:!0},getByUid:{method:"GET",params:{thingUID:"@thingUID"},url:t.restPath+"/:thingUID"},update:{method:"GET",params:{thingUID:"@thingUID"},url:t.restPath+"/update/:thingUID"}})}]),angular.module("PaperUI.services",["PaperUI.services.repositories","PaperUI.constants"]).config(["$httpProvider",function(e){var t=localStorage.getItem("paperui.language");t&&(e.defaults.headers.common["Accept-Language"]=t),e.interceptors.push(["$q","$injector",function(e,t){return{responseError:function(n){var r=n.data.showError;if(r!==!1){var a="";a=n.data&&n.data.customMessage?n.data.customMessage:n.statusText,t.get("toastService").showErrorToast("ERROR: "+n.status+" - "+a)}return e.reject(n)}}}])}]).factory("eventService",["$resource","$log","restConfig",function(e,t,n){var r,a=[],i=function(){r=new EventSource(n.eventPath),t.debug("Initializing event service."),r.addEventListener("error",function(e){2===r.readyState&&(t.debug("Event connection broken. Trying to reconnect in 5 seconds."),setTimeout(i,5e3))}),r.addEventListener("message",function(e){var n=JSON.parse(e.data);t.debug("Event received: "+n.topic+" - "+n.payload),$.each(a,function(e,t){var r=n.topic.match(t.topic);null!=r&&r==n.topic&&t.callback(n.topic,JSON.parse(n.payload))})})};return"undefined"!=typeof EventSource&&i(),new function(){this.onEvent=function(e,t){var n=e.replace("/","/").replace("*",".*");a.push({topic:n,callback:t})}}}]).factory("toastService",["$mdToast","$rootScope",function(e,t){return new function(){var n=this;this.showToast=function(n,r,a,i){var o=e.simple().content(r);a?(o.action(a),o.hideDelay(6e3)):o.hideDelay(3e3),o.position("bottom right"),e.show(o).then(function(e){"ok"==e&&t.$location.path(i)})},this.showDefaultToast=function(e,t,r){n.showToast("default",e,t,r)},this.showErrorToast=function(e,t,r){n.showToast("error",e,t,r)},this.showSuccessToast=function(e,t,r){n.showToast("success",e,t,r)}}}]).factory("configService",["itemService","thingRepository","ruleRepository","$filter","itemRepository",function(e,t,n,r,a){var i=function(e){!e.required&&(e.options&&e.options.length>0||e.context)&&e.options.splice(0,0,{label:"",value:null})},o=function(e){if(!e.context)return!1;var t=e.context.toUpperCase();switch(t){case"ITEM":case"CHANNEL":case"THING":case"RULE":e.multiple?(e.element="multiSelect",e.limitToOptions=!0):e.element="select";break;case"DATE":"TEXT"===e.type.toUpperCase()?e.element="date":(e.element="input",e.context="");break;case"TIME":e.element="input","TEXT"===e.type.toUpperCase()?e.inputType="time":e.context="";break;case"COLOR":e.element="color",e.input="TEXT",e.inputType="color";break;case"SCRIPT":e.element="textarea",e.inputType="text",e.label=e.label&&e.label.length>0?e.label:"Script";break;case"DAYOFWEEK":e.element="dayofweek",e.inputType="text";break;case"PASSWORD":e.element="input",e.inputType="password";break;case"LOCATION":e.element="location";break;default:return!1}return"RULE"===t&&(e.options=e.options?e.options:[],n.getAll(function(t){angular.forEach(t,function(t){t.value=t.uid,t.label=t.name,e.options.push(t)})})),!0},s=function(e){var t=e.type?e.type.toUpperCase():"TEXT";switch(t){case"TEXT":case"INTEGER":case"DECIMAL":e.inputType="TEXT"===t?"text":"number",e.options=e.options&&e.options.length>0?e.options:[],e.multiple?e.element="multiSelect":e.options.length>0?e.limitToOptions?e.element="select":e.element="multiSelect":e.element="input";break;case"BOOLEAN":e.element="switch";break;default:e.element="input",e.inputType="text"}"TEXT"===t&&i(e),"INTEGER"===t&&(u(e,parseInt),e.pattern||(e.pattern="-?\\d+")),"DECIMAL"===t&&u(e,parseFloat)},u=function(e,t){angular.forEach(e.options,function(e){e.value=t(e.value)}),e.defaultValue&&(e.defaultValue=t(e.defaultValue))},l=function(e){function n(e,t){for(var n=[],r=0;r<e.length;r++){for(var a=m(e[r].channels,t),i=0;i<a.length;i++)a[i].label=e[r].label,a[i].value=a[i].uid;n=n.concat(a)}return n}for(var r,a=e,i=0;!r&&i<a.length;i++){var o=$.grep(a[i].parameters,function(e){return e.context&&("THING"==e.context.toUpperCase()||"CHANNEL"==e.context.toUpperCase())});o.length>0&&(r=!0),r&&t.getAll(function(e){for(var t=0;t<a.length;t++)for(var r=0;r<a[t].parameters.length;r++)a[t].parameters[r].context&&("THING"===a[t].parameters[r].context.toUpperCase()?a[t].parameters[r].options=m(e,a[t].parameters[r].filterCriteria):"CHANNEL"===a[t].parameters[r].context.toUpperCase()&&(a[t].parameters[r].options=n(e,a[t].parameters[r].filterCriteria)))})}return a},c=function(e){var t=e,n=[];return angular.forEach(t,function(e){n=n.concat($.grep(e.parameters,function(e){return e.context&&"ITEM"==e.context.toUpperCase()}))}),n.length>0&&a.getAll(function(e){angular.forEach(t,function(t){angular.forEach(t.parameters,function(t){if(t.context&&"ITEM"===t.context.toUpperCase()){var n=m(e,t.filterCriteria);t.options=r("orderBy")(n,"label")}})})}),t},m=function(e,t){return t&&0!=t.length?$.grep(e,function(n,r){return $.grep(t,function(t){if(e[r].hasOwnProperty(t.name)&&""!=t.value&&null!=t.value){var n=t.value.split(",");return $.grep(n,function(n){return Array.isArray(e[r][t.name])?$.grep(e[r][t.name],function(e){return e.toUpperCase().indexOf(n.toUpperCase())!=-1}).length>0:e[r][t.name].toUpperCase().indexOf(n.toUpperCase())!=-1}).length>0}return!1}).length==t.length}):e},p=function(e,t){for(var n=0;n<e.length;n++)for(var r=0;e[n].parameters&&r<e[n].parameters.length;r++)if(e[n].parameters[r].name==t)return e[n].parameters[r];return null};return{getRenderingModel:function(e,t){if(!e||0==e.length)return[];t||(t=[]),t.push({name:"_default",label:"Others"});var n={};angular.forEach(t,function(e,t){n[e.name]=t});var a=[];angular.forEach(e,function(e){e.locale=window.localStorage.getItem("paperui.language"),e.filterText="";var i=o(e);i||s(e);var u=r("filter")(t,function(t){var r=n[e.groupName]>=0?e.groupName:"_default";return t.name===r}),l=n[u[0].name];a[l]||(a[l]={parameters:[]}),a[l].groupName=u[0].name,a[l].groupLabel=u[0].label,a[l].advanced=u[0].advanced,a[l].parameters.push(e)});var i=[];return i.hasAdvanced=!1,angular.forEach(a,function(e){e.advanced&&angular.forEach(e.parameters,function(e){e.advanced=!0}),e.advParam=r("filter")(e.parameters,function(e){return e.advanced}).length,e.advParam>0&&(i.hasAdvanced=!0),i.push(e)}),i=c(i),l(i)},getConfigAsArray:function(e,t){var n=[];return angular.forEach(e,function(r,a){var r=e[a];if(t){var i=p(t,a),o=Date.parse(r);null!==i&&i.context&&!isNaN(o)&&("TIME"===i.context.toUpperCase()?r=(r.getHours()<10?"0":"")+r.getHours()+":"+(r.getMinutes()<10?"0":"")+r.getMinutes():"DATE"===i.context.toUpperCase()&&(r=r.getFullYear()+"-"+(r.getMonth()+1<10?"0":"")+(r.getMonth()+1)+"-"+r.getDate()))}n.push({name:a,value:r})}),n},getConfigAsObject:function(e,t,n){for(var r={},a=0;e&&a<e.length;a++){var i=e[a],o=p(t,i.name);if(null!==o&&"BOOLEAN"==o.type.toUpperCase())i.value="TRUE"==String(i.value).toUpperCase();else if(null!==o&&o.context)if("TIME"===o.context.toUpperCase()){var s=i.value?i.value.split(/[\s\/,.:-]+/):[];s.length>1&&(i.value=new Date(1970,0,1,s[0],s[1]))}else if("DATE"===o.context.toUpperCase()){var u=i.value?i.value.split(/[\s\/,.:-]+/):[];u.length>2?i.value=new Date(u[1]+"/"+u[2]+"/"+u[0]):i.value=null}r[i.name]=i.value}return r},setDefaults:function(e,t){t&&t.configParameters&&$.each(t.configParameters,function(t,n){if("null"!==n.defaultValue)if("TEXT"===n.type)e.configuration[n.name]=n.defaultValue;else if("BOOLEAN"===n.type){var r=null!=e.configuration[n.name]&&""!=e.configuration[n.name]?e.configuration[n.name]:null!=n.defaultValue?n.defaultValue:"";String(r).length>0&&(e.configuration[n.name]="TRUE"==String(r).toUpperCase())}else"INTEGER"===n.type?e.configuration[n.name]=null!=n.defaultValue&&""!==n.defaultValue?parseInt(n.defaultValue):"":"DECIMAL"===n.type?e.configuration[n.name]=null!=n.defaultValue&&""!==n.defaultValue?parseFloat(n.defaultValue):"":e.configuration[n.name]=n.defaultValue;else e.configuration[n.name]=null})},setConfigDefaults:function(e,t,n){if(!t)return e;var r={};angular.copy(e,r);for(var a=0;a<t.length;a++)$.each(t[a].parameters,function(e,t){var a=null!=r[t.name]&&String(r[t.name]).length>0;if(!t.context||"DATE"!==t.context.toUpperCase()&&"TIME"!==t.context.toUpperCase())if(a||!t.context||"COLOR"!==t.context.toUpperCase()||n)if(a||"TEXT"!==t.type)if("BOOLEAN"===t.type){var i=a?r[t.name]:t.defaultValue;String(i).length>0&&(r[t.name]="TRUE"==String(i).toUpperCase())}else a||"INTEGER"!==t.type?a||"DECIMAL"!==t.type?a||(r[t.name]=t.defaultValue):r[t.name]=null!=t.defaultValue&&""!==t.defaultValue?parseFloat(t.defaultValue):null:r[t.name]=null!=t.defaultValue&&""!==t.defaultValue?parseInt(t.defaultValue):null;else r[t.name]=t.defaultValue;else;else{var o=a?r[t.name]:t.defaultValue?t.defaultValue:null;if(o)if("undefined"!=typeof n&&n)"DATE"===t.context.toUpperCase()?r[t.name]=o instanceof Date?o.getFullYear()+"-"+(o.getMonth()+1<10?"0":"")+(o.getMonth()+1)+"-"+o.getDate():o:r[t.name]=o instanceof Date?(o.getHours()<10?"0":"")+o.getHours()+":"+(o.getMinutes()<10?"0":"")+o.getMinutes():o;else if("TIME"===t.context.toUpperCase()){var s=o.split(/[\s\/,.:-]+/);s.length>1&&(r[t.name]=new Date(1970,0,1,s[0],s[1]))}else{var u=o.split(/[\s\/,.:-]+/);u.length>2?r[t.name]=new Date(u[1]+"/"+u[2]+"/"+u[0]):r[t.name]=null}}!t.limitToOptions&&t.filterText&&t.filterText.length>0&&(Array.isArray(r[t.name])?r[t.name].push(t.filterText):r[t.name]=t.filterText)});return this.replaceEmptyValues(r)},convertValues:function(e,t){return angular.forEach(e,function(t,n){if(t&&"boolean"!=typeof t){var r=Number(t);isNaN(r)?e[n]=t:e[n]=r}}),e},replaceEmptyValues:function(e){return angular.forEach(e,function(t,n){void 0!==e[n]&&null!=e[n]&&""!==e[n]||(e[n]=null)}),e}}}]).factory("thingConfigService",function(){return{getThingChannels:function(e,t,n,r){var a=[],i=[];if(t&&t.channelGroups&&t.channelGroups.length>0){angular.forEach(t.channelGroups,function(o){var s={};s.name=o.label,s.description=o.description,s.channels=this.matchGroup(e.channels,o.id),i=i.concat(s.channels),s.channels=r?s.channels:this.filterAdvance(t,n,s.channels,!1),a.push(s)},this);var o={name:"Others",description:"Other channels",channels:[]};angular.forEach(e.channels,function(e){i.indexOf(e)==-1&&o.channels.push(e)}),o.channels&&o.channels.length>0&&a.push(o)}else{var o={};o.channels=r?e.channels:this.filterAdvance(t,n,e.channels,r),a.push(o)}return a=this.addTypeToChannels(a,n)},filterAdvance:function(e,t,n,r){return n.filter(function(n){var a=this.getChannelTypeByUID(e,t,n.channelTypeUID);return!a||r==a.advanced},this)},getChannelTypeByUID:function(e,t,n){if(e){if(e.channels&&e.channels.length>0){var r=e.channels.filter(function(e){return e.typeUID===n});if(r.length>0)return r[0]}e.channelGroups&&e.channelGroups.length>0&&angular.forEach(e.channelGroups,function(e){if(e&&e.channels){var t=e.channels.filter(function(e){return e.typeUID===n});if(t.length>0)return t[0]}})}if(t)return this.getChannelFromChannelTypes(t,n)},getChannelFromChannelTypes:function(e,t){var n=e.filter(function(e){return e.UID===t});return n.length>0?n[0]:null},matchGroup:function(e,t){for(var n=[],r=0;r<e.length;r++)if(e[r].id){var a=e[r].id.split("#");a[0]&&a[0]==t&&n.push(e[r])}return n},addTypeToChannels:function(e,t){return angular.forEach(e,function(e){angular.forEach(e.channels,function(e){e.channelType=this.getChannelFromChannelTypes(t,e.channelTypeUID)},this)},this),e}}}).factory("titleService",function(){function e(e){this.titleCallback&&this.titleCallback(e)}function t(e){this.titleCallback=e}function n(e){this.subtitlesCallback&&this.subtitlesCallback(e)}function r(e){this.subtitlesCallback=e}return{setTitle:e,onTitle:t,setSubtitles:n,onSubtitles:r}}).provider("dateTime",function(){var e,t,n;return"de"==window.localStorage.getItem("paperui.language")?(e=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],n=2):(e=["January","February","March","April","May","June","July","August","September","October","November","December"],t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=3),{getMonths:function(t){if(t){for(var n=[],r=0;r<e.length;r++)n.push(e[r].substr(0,3));return n}return e},$get:function(){return{getMonths:function(t){if(t){for(var n=[],r=0;r<e.length;r++)n.push(e[r].substr(0,3));return n}return e},getDaysOfWeek:function(e){if(e){for(var r=[],a=0;a<t.length;a++)r.push(t[a].substr(0,n));return r}return t}}}}});